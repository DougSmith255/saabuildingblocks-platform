# Apache Virtual Host Configuration for Master Controller
# This configuration should be added to /etc/apache2/sites-available/000-default-le-ssl.conf
# IMPORTANT: Insert BEFORE the WordPress DocumentRoot section

# ===================================================================
# MASTER CONTROLLER - Next.js Development Server Proxy
# ===================================================================

# Proxy WebSocket connections for hot reload (HMR)
<Location /master-controller/_next/webpack-hmr>
    ProxyPass ws://localhost:3001/master-controller/_next/webpack-hmr
    ProxyPassReverse ws://localhost:3001/master-controller/_next/webpack-hmr
</Location>

# Proxy Next.js static assets
<Location /master-controller/_next/>
    ProxyPass http://localhost:3001/master-controller/_next/
    ProxyPassReverse http://localhost:3001/master-controller/_next/
    ProxyPreserveHost On
</Location>

# Proxy Master Controller application
<Location /master-controller>
    ProxyPass http://localhost:3001/master-controller
    ProxyPassReverse http://localhost:3001/master-controller
    ProxyPreserveHost On

    # Required headers for HTTPS and hot reload
    RequestHeader set X-Forwarded-Proto "https"
    RequestHeader set X-Forwarded-For "%{REMOTE_ADDR}s"
</Location>

# ===================================================================
# End of Master Controller Configuration
# ===================================================================

# Installation Instructions:
#
# 1. Enable required Apache modules:
#    sudo a2enmod proxy proxy_http proxy_wstunnel rewrite headers
#
# 2. Edit SSL virtual host:
#    sudo nano /etc/apache2/sites-available/000-default-le-ssl.conf
#
# 3. Copy the configuration above and paste it BEFORE the DocumentRoot line
#
# 4. Test configuration:
#    sudo apache2ctl configtest
#
# 5. Restart Apache:
#    sudo systemctl restart apache2
#
# 6. Verify:
#    curl -I https://saabuildingblocks.com/master-controller
